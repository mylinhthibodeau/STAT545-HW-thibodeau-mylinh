---
title: "hw04-activity5-data-manipulation-cheat-sheet-thibodeau-mylinh"
author: "My Linh Thibodeau"
date: '2017-10-07'
output: github_document
---

```{r}
suppressPackageStartupMessages(library(tidyverse))
knitr::opts_chunk$set(fig.width=12, fig.height=9)
library(knitr)
library(kableExtra)
library(reshape2)
options(knitr.table.format = "html")
```

# Essentials of data manipulations in R

# Matching tasks and functions

| Task          | tidyr function          | reshape2 function   | base R                      |
|---------------|-------------------------|---------------------|-----------------------------|
|               |                         |                     |                             |
|1. Group       | group_by()              | cast()              | aggregate(~ group)          |
|               |                         |                     |                             | 
|2. Split       | spread(), separate()    | dcast()             | table()                     |
|               |                         |                     |                             | 
|3. Stack       | gather()                | melt()              |                             | 
|               |                         |                     |                             | 
|4. Join        | _join functions         | reshape::merge_all  | merge(), cbind(), rbind()   |
|               |                         |                     |                             | 
|5. Subset      | filter(), extract()     |                     |                             |  
|               |                         |                     |                             | 
|6. Transpose   | gather()/spread()       |                     | data.frame(t())             |
|               |                         |                     |                             | 
|7. Sort        | arrange()               |                     |                             |
|               |                         |                     |                             |

***

Let's make a small table to illustrate the different funcitons.
```{r}
d1 <- read.table("small_dataframe_example.txt",sep = "\t", header = TRUE)
d1 %>%
  kable("html") %>% kable_styling()
```

## GROUP

Objective: group gene.type and copy.state, when count the number of rows (pairs) and the sum of the copy.number for each pair.

### Tidyr

```{r}
d1_gr <- select(d1, gene.type, expression, copy.number) %>%
  group_by(gene.type, expression) %>%
  summarize(Nrows = n(), SumCol.copy.number = sum(copy.number))
d1_gr %>% kable("html") %>% kable_styling()
```

## SPLIT

Objective: transform the Nrows column (count of gene.type-expression pairs) of d1_gr so that each group (TS, ONC) is represented by one row, each expression category by one column, and the numbers (Nrows of d1_gr) represent the number of occurence in each pair (gene.type-expression).

### Tidyr

### Reshape

```{r}
d1_split <- d1_gr %>%
  dcast(gene.type~expression, value.var = "Nrows")
d1_split %>% kable("html") %>% kable_styling()
```

## STACK

Objective: display d1_split in a way such that all gene.type - expression possible pairs are displayed in col1 and col2, which col3 returns the count of such pairs (Nrows)

### Tidyr

### Reshape

```{r}
d1_stack <- melt(d1_split, id="gene.type") %>%
  arrange(gene.type)
d1_stack %>% kable("html") %>% kable_styling()
```

Let's prepare another dataset (d2) for the following exercises.
```{r}
d2 <- read.table("small_dataframe_example_2.txt",sep = "\t", header = TRUE)
d2 %>% kable("html") %>% kable_styling()
```


## JOIN

Objective: join d1 and d2 according to the common column gene.

### Tidyr

#### left_join()

```{r}
d3_join <- left_join(d1, d2, by = "gene")
d3_join %>% kable("html") %>% kable_styling()
```


## SUBSET

Objective: only take the data for the ONC gene.type.

### Tidyr

```{r}
d3_ONC <- d3_join %>%
  filter(gene.type == "ONC") 
d3_ONC %>% kable("html") %>% kable_styling()
``` 


## TRANSPOSE

Objective: take the d3_ONC horizontal table and transpose it to a vertical position such that the rows become columns and vice versa.

### Base R

```{r}
d3_ONC_transpose <- data.frame(t(d3_ONC))
d3_ONC_transpose %>% kable("html") %>% kable_styling()
```

## SORT

Objective:

### Tidyr

```{r}
arrange()
```


***                
REFERENCES
Reshape2 manual [here](https://www.rdocumentation.org/packages/reshape2/versions/1.4.2)
Reshape reference [here](http://had.co.nz/reshape/), [here](https://stackoverflow.com/questions/8091303/simultaneously-merge-multiple-data-frames-in-a-list)
Blog on data manipulation [here](https://www.r-statistics.com/2012/01/aggregation-and-restructuring-data-from-r-in-action/), and [here](http://library.open.oregonstate.edu/computationalbiology/chapter/reshaping-and-joining-data-frames/)
Panda can also offer options, as exemplified [here](https://pandas.pydata.org/pandas-docs/stable/merging.html), but I ran out of time to look into this further.