---
title: "hw05-trials-errors-saved-history"
author: "My Linh Thibodeau"
date: '2017-10-14'
output: github_document
---

```{r}
suppressPackageStartupMessages(library(tidyverse))
knitr::opts_chunk$set(fig.width=12, fig.height=9)
library(knitr)
library(kableExtra)
options(knitr.table.format = "html")
library(readr)
library(forcats)
#install.packages("gdata")
library(gdata)
library(lattice)
#install.packages("tidygenomics") # Not used for now, but perhaps in another homework
#library(tidygenomics) # Not used for now, but perhaps in another homework
```


READING A FILE

FAILED 1
```{r}
chek2_rna_cnv_f <- read_table2("/Users/mylinh/Desktop/chek2-data-trial-stat545/chek2-rna-expression-cnv-data.txt")
View(chek2_rna_cnv_f)
sapply(chek2_rna_cnv_f, class)
# class(chek2_rna_cnv_f)
# typeof(chek2_rna_cnv_f)
summary(chek2_rna_cnv_f) %>% kable("html") %>% kable_styling()
dim(chek2_rna_cnv_f)
```

FAILED 2
```{r}
dget("/Users/mylinh/Desktop/chek2-data-trial-stat545/chek2-rna-expression-cnv-data.txt", keep.source = TRUE)
```


```{r}
dget("/Users/mylinh/Desktop/chek2-data-trial-stat545/chek2-rna-expression-cnv-data.txt")
```

# Removed from (1A)


```{r}
gene_types_baseR <-  factor(chek2_rna_cnv$cancer.gene.type)
gene_types_baseR %>% head(100) %>% kable("html") %>% kable_styling()
gene_types_forcats <- as_factor(chek2_rna_cnv$cancer.gene.type)
gene_types_forcats %>% head(100) %>% kable("html") %>% kable_styling()
```

LONG VERSION

## (1A) Factorise

Transform some of the variable of chek2_rna_cnv into factors. In cleaning up the dataset, we converted a factors column into characters then back to factors. 

Let's see what class of data we have in chek2_rna_cnv first. 
```{r}
sapply(chek2_rna_cnv, class) %>% kable("html") %>% kable_styling()
```


Change the avg.TCGA.percentile (class integer) to factors with base R:
```{r}
chek2_rna_cnv$avg.TCGA.percentile <- as.factor(chek2_rna_cnv$avg.TCGA.percentile)
chek2_rna_cnv %>% 
  select(hugo,avg.TCGA.percentile) %>%
  head(10) %>% kable("html") %>% kable_styling()
#chek2_rna_cnv$avg.TCGA.percentile %>% head(10) %>% kable("html") %>% kable_styling()
nlevels(chek2_rna_cnv$avg.TCGA.percentile)
#avg.TCGA.percentile_types <- levels(chek2_rna_cnv$avg.TCGA.percentile) # alternative method to count levels
#avg.TCGA.percentile_types
#length(avg.TCGA.percentile_types)
#avg.TCGA.percentile_types
```

Change the avg.TCGA.percentile (class integer) to factors with forcats:

```{r}
chek2_rna_cnv$avg.TCGA.percentile <- as_factor(chek2_rna_cnv$avg.TCGA.percentile) 
chek2_rna_cnv %>% 
  select(hugo,avg.TCGA.percentile) %>%
  head(10) %>% kable("html") %>% kable_styling()
nlevels(chek2_rna_cnv$avg.TCGA.percentile)
#chek2_rna_cnv$avg.TCGA.percentile %>% head(10) %>% kable("html") %>% kable_styling()
#avg.TCGA.percentile_types <- levels(chek2_rna_cnv$avg.TCGA.percentile)
#avg.TCGA.percentile_types
```


#### REORDER ACCORDING TO FREQUENCY - UNABLE TO KNITR


Error message: line 251 Error:`f` must be a factor (or cahracter vector). Execution halted.

We can also order the data.frame factors according to their frequency. 

```{r}
d2_baseR <- levels(d2$avg.TCGA.percentile) 
d2_baseR %>% head(5) %>% kable("html") %>% kable_styling()
d2_cats <- d2$avg.TCGA.percentile %>%
  forcats::fct_infreq() %>% levels()
d2_cats %>% head(5) %>% kable("html") %>% kable_styling()
```

# Removed from 1C

```{r}
chek2_rna_cnv$avg.TCGA.percentile <- as.numeric(chek2_rna_cnv$avg.TCGA.percentile) 
class(chek2_rna_cnv$avg.TCGA.percentile)
d3 <- chek2_rna_cnv %>%
  filter(avg.TCGA.percentile != 0) %>%
  arrange(avg.TCGA.percentile) %>%
  group_by(cancer.gene.type) %>%
  summarize(mean_by_type = mean(avg.TCGA.percentile)) %>%
  mutate(exp_interpret = cut(RPKM, breaks = c(-Inf, 10, 90, Inf), labels =c("low", "middle", "high")))
head(d3)
```


NOT WORKING

Let's make a plot of the count for each avg.TCGA.percentile factor.
```{r}
p4 <- d2 %>%
  group_by(cancer.gene.type) %>%
  head(2000) %>%
  ggplot(aes(x=avg.TCGA.percentile))
p4 + geom_bar(aes(fill=cancer.gene.type))
```

Now, let's order them according to the ones with the maximum counts.

```{r}
p4 <- d2 %>%
  group_by(cancer.gene.type) %>%
  head(2000) %>%
  ggplot(aes(x=avg.TCGA.percentile, y=fct_reorder(avg.TCGA.percentile, count)), na.rm=TRUE)
p4 + geom_bar()
```


# (2) Visualization design - Improve a figure 


Merge color into data, as shown [here](https://github.com/jennybc/ggplot2-tutorial/blob/master/02-merge-color-into-data.r)

```{r}
library(plyr)
hugo_colors_v2 <- read.delim("chek2-hugo-colors.tsv", colClasses = list(color = "character"), col.names = c("cancer.gene.type", "hugo", "hugo_color"))
str(hugo_colors_v2)

#insert color as a variable into d5
d5 <- merge(d5, hugo_colors_v2)
View(d5)

hugo_colors_v3 <- hugo_colors[,2:3]
head(hugo_colors_v3)
hugo_colors_v3_t <- t(hugo_colors_v3)
head(hugo_colors_v3_t)
```

Remove all legend example [here](http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/)